<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <title>Thêm Nhân Viên - Admin</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/modern-dashboard.css}">
</head>
<body>
    <!-- Navbar Fragment -->
    <div th:insert="~{shop/fragments/navbar :: navbar}"></div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" th:href="@{/shop/admin/dashboard}">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" th:href="@{/shop/admin/employees}">
                                <i class="bi bi-people"></i> Nhân Viên
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" th:href="@{/shop/admin/customers}">
                                <i class="bi bi-person-circle"></i> Khách Hàng
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" th:href="@{/shop/admin/products}">
                                <i class="bi bi-box"></i> Sản Phẩm
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" th:href="@{/shop/admin/orders}">
                                <i class="bi bi-cart"></i> Đơn Hàng
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <a th:href="@{/shop/admin/employees}" class="text-decoration-none text-muted me-2">
                            <i class="bi bi-arrow-left"></i>
                        </a>
                        Thêm Nhân Viên Mới
                    </h1>
                </div>

                <!-- Form -->
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-person-plus me-2"></i>Thông Tin Nhân Viên
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Error Messages -->
                                <div th:if="${error}" class="alert alert-danger" role="alert">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <span th:text="${error}"></span>
                                </div>

                                <form th:action="@{/shop/admin/employees/add}" method="post" id="employeeForm" novalidate>
                                    <div class="row">
                                        <!-- Employee Name -->
                                        <div class="col-md-6 mb-3">
                                            <label for="employeeName" class="form-label">
                                                Tên Nhân Viên <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="employeeName" name="employeeName" 
                                                   th:value="${employee?.employeeName}" required>
                                            <div class="invalid-feedback">
                                                Vui lòng nhập tên nhân viên.
                                            </div>
                                        </div>

                                        <!-- Department -->
                                        <div class="col-md-6 mb-3">
                                            <label for="department" class="form-label">
                                                Phòng Ban <span class="text-danger">*</span>
                                            </label>
                                            <select class="form-select" id="department" name="department" required 
                                                    title="Chọn phòng ban">
                                                <option value="">Chọn phòng ban</option>
                                                <option value="IT" th:selected="${employee?.department == 'IT'}">IT</option>
                                                <option value="Sales" th:selected="${employee?.department == 'Sales'}">Sales</option>
                                                <option value="Marketing" th:selected="${employee?.department == 'Marketing'}">Marketing</option>
                                                <option value="HR" th:selected="${employee?.department == 'HR'}">HR</option>
                                                <option value="Finance" th:selected="${employee?.department == 'Finance'}">Finance</option>
                                            </select>
                                            <div class="invalid-feedback">
                                                Vui lòng chọn phòng ban.
                                            </div>
                                        </div>

                                        <!-- Role -->
                                        <div class="col-md-6 mb-3">
                                            <label for="role" class="form-label">
                                                Vai Trò <span class="text-danger">*</span>
                                            </label>
                                            <select class="form-select" id="role" name="role" required 
                                                    title="Chọn vai trò">
                                                <option value="">Chọn vai trò</option>
                                                <option value="Employee" th:selected="${employee?.role == 'Employee'}">Nhân viên</option>
                                                <option value="Manager" th:selected="${employee?.role == 'Manager'}">Quản lý</option>
                                                <option value="Admin" th:selected="${employee?.role == 'Admin'}">Admin</option>
                                            </select>
                                            <div class="invalid-feedback">
                                                Vui lòng chọn vai trò.
                                            </div>
                                        </div>

                                        <!-- Salary -->
                                        <div class="col-md-6 mb-3">
                                            <label for="salary" class="form-label">
                                                Lương <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="salary" name="salary" 
                                                       th:value="${employee?.salary}" min="1000000" max="100000000" required>
                                                <span class="input-group-text">VND</span>
                                            </div>
                                            <div class="invalid-feedback">
                                                Vui lòng nhập lương từ 1,000,000 - 100,000,000 VND.
                                            </div>
                                            <div class="form-text">
                                                Lương từ 1,000,000 đến 100,000,000 VND
                                            </div>
                                        </div>

                                        <!-- Username -->
                                        <div class="col-md-6 mb-3">
                                            <label for="username" class="form-label">
                                                Tên Đăng Nhập <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control" id="username" name="username" 
                                                   th:value="${employee?.login?.username}" required 
                                                   pattern="^[a-zA-Z0-9._]{3,20}$">
                                            <div class="invalid-feedback">
                                                Tên đăng nhập từ 3-20 ký tự, chỉ chứa chữ, số, dấu chấm và gạch dưới.
                                            </div>
                                        </div>

                                        <!-- Password -->
                                        <div class="col-md-6 mb-3">
                                            <label for="password" class="form-label">
                                                Mật Khẩu <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="password" name="password" 
                                                       required minlength="6">
                                                <button class="btn btn-outline-secondary" type="button" 
                                                        onclick="togglePassword('password')" title="Hiện/ẩn mật khẩu">
                                                    <i class="bi bi-eye" id="passwordIcon"></i>
                                                </button>
                                            </div>
                                            <div class="invalid-feedback">
                                                Mật khẩu phải có ít nhất 6 ký tự.
                                            </div>
                                        </div>

                                        <!-- Confirm Password -->
                                        <div class="col-md-6 mb-3">
                                            <label for="confirmPassword" class="form-label">
                                                Xác Nhận Mật Khẩu <span class="text-danger">*</span>
                                            </label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="confirmPassword" 
                                                       name="confirmPassword" required minlength="6">
                                                <button class="btn btn-outline-secondary" type="button" 
                                                        onclick="togglePassword('confirmPassword')" title="Hiện/ẩn mật khẩu">
                                                    <i class="bi bi-eye" id="confirmPasswordIcon"></i>
                                                </button>
                                            </div>
                                            <div class="invalid-feedback" id="confirmPasswordFeedback">
                                                Mật khẩu xác nhận không khớp.
                                            </div>
                                        </div>

                                        <!-- User Type -->
                                        <div class="col-md-6 mb-3">
                                            <label for="userType" class="form-label">
                                                Loại Tài Khoản <span class="text-danger">*</span>
                                            </label>
                                            <select class="form-select" id="userType" name="userType" required 
                                                    title="Chọn loại tài khoản">
                                                <option value="">Chọn loại tài khoản</option>
                                                <option value="employee" selected>Nhân viên</option>
                                                <option value="admin">Admin</option>
                                            </select>
                                            <div class="invalid-feedback">
                                                Vui lòng chọn loại tài khoản.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Submit Buttons -->
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                                <a th:href="@{/shop/admin/employees}" class="btn btn-secondary me-md-2">
                                                    <i class="bi bi-x-circle me-1"></i>Hủy
                                                </a>
                                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                                    <i class="bi bi-check-circle me-1"></i>Thêm Nhân Viên
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Form validation
        document.getElementById('employeeForm').addEventListener('submit', function(event) {
            if (!this.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            this.classList.add('was-validated');
        });

        // Password confirmation validation
        function validatePasswordMatch() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmField = document.getElementById('confirmPassword');
            
            if (password !== confirmPassword) {
                confirmField.setCustomValidity('Mật khẩu xác nhận không khớp');
                document.getElementById('confirmPasswordFeedback').textContent = 'Mật khẩu xác nhận không khớp.';
            } else {
                confirmField.setCustomValidity('');
                document.getElementById('confirmPasswordFeedback').textContent = 'Mật khẩu xác nhận không khớp.';
            }
        }

        document.getElementById('password').addEventListener('input', validatePasswordMatch);
        document.getElementById('confirmPassword').addEventListener('input', validatePasswordMatch);

        // Toggle password visibility
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = document.getElementById(fieldId + 'Icon');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.className = 'bi bi-eye-slash';
            } else {
                field.type = 'password';
                icon.className = 'bi bi-eye';
            }
        }

        // Auto-generate username from employee name
        document.getElementById('employeeName').addEventListener('input', function() {
            const name = this.value.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/[^a-z0-9]/g, '');
            document.getElementById('username').value = name;
        });

        // Format salary input
        document.getElementById('salary').addEventListener('input', function() {
            let value = this.value.replace(/[^0-9]/g, '');
            if (value) {
                this.value = value;
            }
        });
    </script>

    <style>
        .sidebar {
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
        }
        .sidebar .nav-link {
            color: #333;
            padding: 10px 15px;
        }
        .sidebar .nav-link.active {
            color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.1);
        }
        .form-label {
            font-weight: 500;
        }
        .text-danger {
            color: #dc3545 !important;
        }
    </style>
</body>
</html>
