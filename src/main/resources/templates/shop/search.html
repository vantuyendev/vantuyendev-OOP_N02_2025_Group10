<!DOCTYPE HTML>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{app.title} + ' - Advanced Search'">Shop Management System - Advanced Search</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- External CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link href="/css/modern-dashboard.css" rel="stylesheet">
    
    <style>
        .clickable-brand {
            cursor: pointer;
        }
    </style>
</head>
<body class="dashboard-body">
    <!-- Gradient Background -->
    <div class="dashboard-background"></div>
    
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-auto">
                    <div class="dashboard-brand clickable-brand" onclick="location.href='/shop/dashboard'" title="Go to dashboard" aria-label="Go to dashboard">
                        <i class="bi bi-shop"></i>
                        <span>Quản Lý Cửa Hàng Tạp Hóa</span>
                    </div>
                </div>
                <div class="col text-center">
                    <h1 class="dashboard-title">Tìm Kiếm Nâng Cao</h1>
                </div>
                <div class="col-auto">
                    <div class="user-info">
                        <span class="me-3" th:text="'Welcome, ' + ${userSession?.name ?: 'User'}">Welcome, User</span>
                        <a href="/shop/profile" class="btn btn-outline-light btn-sm me-2">Hồ Sơ</a>
                        <a href="/shop/logout" class="btn btn-outline-light btn-sm">Đăng Xuất</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
                        </div>
        </div>
    </nav>

    <div class="container dashboard-container">
        <!-- Page Header -->
        <div class="container-fluid py-5">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="page-title">
                        <i class="bi bi-search text-primary me-2"></i>Tìm Kiếm Nâng Cao
                    </h1>
                    <p class="page-subtitle">Tìm kiếm nhân viên, sản phẩm và khách hàng với bộ lọc nâng cao</p>
                </div>
                <div class="col-auto">
                    <a href="/shop/dashboard" class="btn-modern btn-outline">
                        <i class="bi bi-arrow-left me-1"></i>Về Dashboard
                    </a>
                </div>
            </div>
        </div>

    <!-- Main Content -->
    <div class="container main-container">
        <!-- Search Features -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="feature-card" onclick="showSearchTab('products')">
                    <div class="feature-icon">
                        <i class="bi bi-box"></i>
                    </div>
                    <h3>Tìm Sản Phẩm</h3>
                    <p>Tìm kiếm sản phẩm theo tên, danh mục, giá cả</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="feature-card" onclick="showSearchTab('customers')">
                    <div class="feature-icon">
                        <i class="bi bi-person-hearts"></i>
                    </div>
                    <h3>Tìm Khách Hàng</h3>
                    <p>Tìm kiếm khách hàng theo tên, số điện thoại, địa chỉ</p>
                </div>
            </div>
        </div>

        <!-- Search Content -->
        <div class="content-card">
            <div class="card-header">
                <ul class="nav nav-pills" id="searchTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="products-tab" data-bs-toggle="pill" 
                                data-bs-target="#products-search" type="button" role="tab">
                            <i class="bi bi-box me-1"></i>Sản Phẩm
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="customers-tab" data-bs-toggle="pill" 
                                data-bs-target="#customers-search" type="button" role="tab">
                            <i class="bi bi-person-hearts me-1"></i>Khách Hàng
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="searchTabsContent">
                    <!-- Products Search -->
                    <div class="tab-pane fade show active" id="products-search" role="tabpanel">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="prod-name" placeholder="Tên sản phẩm">
                                    <label for="prod-name"><i class="bi bi-box me-1"></i>Tên Sản Phẩm</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="prod-category" placeholder="Danh mục">
                                    <label for="prod-category"><i class="bi bi-tags me-1"></i>Danh Mục</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="prod-brand" placeholder="Brand">
                                    <label for="prod-brand"><i class="bi bi-award me-1"></i>Brand</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="prod-barcode" placeholder="Barcode">
                                    <label for="prod-barcode"><i class="bi bi-upc-scan me-1"></i>Barcode</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="prod-min-price" placeholder="Min Price">
                                    <label for="prod-min-price"><i class="bi bi-currency-dollar me-1"></i>Min Price</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="prod-max-price" placeholder="Max Price">
                                    <label for="prod-max-price"><i class="bi bi-currency-dollar me-1"></i>Max Price</label>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-modern btn-primary" onclick="searchProducts()">
                            <i class="bi bi-search me-1"></i>Search Products
                        </button>
                        <div id="products-results" class="mt-4"></div>
                    </div>

                    <!-- Customers Search -->
                    <div class="tab-pane fade" id="customers-search" role="tabpanel">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="cust-name" placeholder="Customer Name">
                                    <label for="cust-name"><i class="bi bi-person me-1"></i>Customer Name</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="tel" class="form-control" id="cust-phone" placeholder="Phone Number">
                                    <label for="cust-phone"><i class="bi bi-telephone me-1"></i>Phone Number</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="cust-email" placeholder="Email">
                                    <label for="cust-email"><i class="bi bi-envelope me-1"></i>Email</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="cust-address" placeholder="Address">
                                    <label for="cust-address"><i class="bi bi-geo-alt me-1"></i>Address</label>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-modern btn-primary" onclick="searchCustomers()">
                            <i class="bi bi-search me-1"></i>Search Customers
                        </button>
                        <div id="customers-results" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-5 py-4 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0 text-muted">&copy; 2025 Shop Management System. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="mb-0 text-muted">Advanced Search Module</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/dashboard.js"></script>
    
    <script>
        // Search functions
        async function searchProducts() {
            const name = document.getElementById('prod-name').value;
            const category = document.getElementById('prod-category').value;
            const brand = document.getElementById('prod-brand').value;
            const barcode = document.getElementById('prod-barcode').value;
            const minPrice = document.getElementById('prod-min-price').value;
            const maxPrice = document.getElementById('prod-max-price').value;
            
            const resultsDiv = document.getElementById('products-results');
            resultsDiv.innerHTML = '<div class="text-center"><i class="bi bi-hourglass-split"></i> Searching...</div>';
            
            try {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (category) params.append('category', category);
                if (brand) params.append('brand', brand);
                if (barcode) params.append('barcode', barcode);
                if (minPrice) params.append('minPrice', minPrice);
                if (maxPrice) params.append('maxPrice', maxPrice);
                
                const response = await fetch('/api/products/search?' + params.toString());
                const data = await response.json();
                
                if (data.success) {
                    displayProductResults(data.data);
                } else {
                    resultsDiv.innerHTML = '<div class="alert alert-danger">Error: ' + data.message + '</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="alert alert-danger">Error loading products</div>';
            }
        }
        
        async function searchCustomers() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const email = document.getElementById('cust-email').value;
            const address = document.getElementById('cust-address').value;
            
            const resultsDiv = document.getElementById('customers-results');
            resultsDiv.innerHTML = '<div class="text-center"><i class="bi bi-hourglass-split"></i> Searching...</div>';
            
            try {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (phone) params.append('phone', phone);
                if (email) params.append('email', email);
                if (address) params.append('address', address);
                
                const response = await fetch('/api/customers/search?' + params.toString());
                const data = await response.json();
                
                if (data.success) {
                    displayCustomerResults(data.data);
                } else {
                    resultsDiv.innerHTML = '<div class="alert alert-danger">Error: ' + data.message + '</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="alert alert-danger">Error loading customers</div>';
            }
        }
        
        function displayProductResults(products) {
            const resultsDiv = document.getElementById('products-results');
            
            if (products.length === 0) {
                resultsDiv.innerHTML = '<div class="alert alert-info">No products found matching your criteria.</div>';
                return;
            }
            
            let html = '<div class="card"><div class="card-body"><h5>Search Results (' + products.length + ')</h5>';
            html += '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th>Name</th><th>Category</th><th>Brand</th><th>Price</th><th>Stock</th><th>Actions</th></tr></thead><tbody>';
            
            products.forEach(prod => {
                html += '<tr>';
                html += '<td>' + prod.productName + '</td>';
                html += '<td><span class="badge bg-secondary">' + prod.category + '</span></td>';
                html += '<td>' + prod.brand + '</td>';
                html += '<td>$' + prod.sellingPrice.toFixed(2) + '</td>';
                html += '<td>' + prod.quantity + '</td>';
                html += '<td><a href="/shop/products/edit/' + prod.productId + '" class="btn btn-sm btn-outline-primary">Edit</a></td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
            resultsDiv.innerHTML = html;
        }
        
        function displayCustomerResults(customers) {
            const resultsDiv = document.getElementById('customers-results');
            
            if (customers.length === 0) {
                resultsDiv.innerHTML = '<div class="alert alert-info">No customers found matching your criteria.</div>';
                return;
            }
            
            let html = '<div class="card"><div class="card-body"><h5>Search Results (' + customers.length + ')</h5>';
            html += '<div class="table-responsive"><table class="table table-hover">';
            html += '<thead><tr><th>Name</th><th>Phone</th><th>Email</th><th>Address</th><th>Actions</th></tr></thead><tbody>';
            
            customers.forEach(cust => {
                html += '<tr>';
                html += '<td>' + cust.fullName + '</td>';
                html += '<td>' + cust.phoneNumber + '</td>';
                html += '<td>' + cust.email + '</td>';
                html += '<td>' + cust.address + '</td>';
                html += '<td><a href="/shop/customers/edit/' + cust.userId + '" class="btn btn-sm btn-outline-primary">Edit</a></td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div></div></div>';
            resultsDiv.innerHTML = html;
        }

        // Tab switching function
        function showSearchTab(tab) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('show', 'active');
            });
            
            // Activate selected tab
            const tabElement = document.getElementById(tab + '-tab');
            const paneElement = document.getElementById(tab + '-search');
            
            if (tabElement) tabElement.classList.add('active');
            if (paneElement) {
                paneElement.classList.add('show', 'active');
            }
        }
    </script>
</body>
</html>
